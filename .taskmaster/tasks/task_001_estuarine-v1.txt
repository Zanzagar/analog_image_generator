# Task ID: 1
# Title: Define estuarine parameter schema & slider metadata
# Status: pending
# Dependencies: None
# Priority: medium
# Description: Introduce a strongly typed estuarine parameter schema plus slider metadata so downstream generators and UI can consume a single source of truth for ranges, defaults, and documentation links from the PRD.
# Details:
- Create `EstuarineParams` (e.g., dataclass or TypedDict) under `analog_image_generator.geologic_generators` capturing tidal prism, wave energy index, channel/bar wavelengths (px), mud fraction, delta-front angle φ, dominance δ, interlayer type enum, and RNG seed.
- Keep values normalized to slider ranges from `.taskmaster/docs/prd_estuarine.txt`; compute derived values such as km using the 5 m/px scale only inside helper properties.
- Expose metadata (min, max, step, default, tooltip text citing the correct PDF section) via `analog_image_generator.interactive.build_sliders` so UI consumers read from `PARAM_METADATA["estuarine"]` instead of hardcoding.
- Provide helper `clamp_estuarine_params(raw: Mapping[str, Any]) -> EstuarineParams` that enforces ranges and converts enums/angles.
- Pseudocode:
```
@dataclass
class EstuarineParams:
    tidal_prism: float = 0.5
    ...

PARAM_METADATA = {
  "estuarine": {
      "tidal_prism": {"min": 0.1, "max": 1.0, "step": 0.05, "default": 0.5,
                        "source": "depositional_system_estuarian_tide-dominated.pdf §3"},
      ...
  }
}
```
- Update `docs/GEOLOGIC_RULES.md` later to point to the new helper once implemented (tracked in a later task).

# Test Strategy:
- Add unit tests that instantiate `EstuarineParams` with defaults and boundary values, asserting clamping honors PRD limits and enum normalization (pytest target `tests/test_params.py`).
- Validate `build_sliders("estuarine")` returns metadata for every slider with expected min/max/default and citation text.
- Include a regression test that feeds invalid values (e.g., δ>1) through `clamp_estuarine_params` and asserts the corrected value stays within range.

# Subtasks:
## 1. Extract estuarine parameters and ranges from PRD [pending]
### Dependencies: None
### Description: Review `.taskmaster/docs/prd_estuarine.txt` and identify all required estuarine parameters, their slider ranges, defaults, and any linked documentation sections.
### Details:
Open `.taskmaster/docs/prd_estuarine.txt` and systematically list tidal prism, wave energy index, channel and bar wavelengths (px), mud fraction, delta-front angle φ, dominance δ, interlayer type enum values, RNG seed behavior, and any additional PRD-defined knobs. Record for each parameter the min, max, step, default, and references to PDF sections so they can be encoded in both the strongly typed schema and slider metadata without guesswork.

## 2. Define strongly typed `EstuarineParams` schema [pending]
### Dependencies: 1.1
### Description: Implement a typed parameter container `EstuarineParams` under `analog_image_generator.geologic_generators` using the PRD-derived fields and defaults.
### Details:
Create `EstuarineParams` (e.g., as a `@dataclass` or `TypedDict`) in the appropriate estuarine-related module of `analog_image_generator.geologic_generators`. Include fields for tidal prism, wave energy index, channel and bar wavelengths (in normalized slider units), mud fraction, delta-front angle φ, dominance δ, interlayer type enum, and RNG seed. Ensure defaults match PRD slider defaults and keep all values in the normalized slider units, providing convenience properties for any 5 m/px km conversions without changing stored units.

## 3. Implement `PARAM_METADATA["estuarine"]` slider metadata [pending]
### Dependencies: 1.1
### Description: Create a metadata structure describing slider configuration for estuarine parameters so UI components can consume a single source of truth.
### Details:
Add or extend a shared metadata module to define `PARAM_METADATA["estuarine"]`, mapping each estuarine parameter name to an object containing min, max, step, default, display label, and tooltip text. Ensure tooltip strings cite the correct PDF sections (e.g., `depositional_system_estuarian_tide-dominated.pdf §3`) and that numeric values exactly match ranges and defaults extracted from the PRD. Keep the structure compatible with `analog_image_generator.interactive.build_sliders` expectations.

## 4. Add `clamp_estuarine_params` normalization and validation helper [pending]
### Dependencies: 1.2, 1.3
### Description: Introduce `clamp_estuarine_params(raw: Mapping[str, Any]) -> EstuarineParams` that enforces PRD-backed ranges and normalizes enums and angles.
### Details:
Implement `clamp_estuarine_params` to accept loosely-typed input mappings (e.g., from UI or config files), coerce numeric values into the valid slider ranges using `PARAM_METADATA["estuarine"]`, and normalize categorical values such as interlayer type enums and angles like φ and δ (e.g., degrees vs radians). Use the `EstuarineParams` schema for the return type, ensuring that any out-of-range or malformed values are clamped or converted consistently and that defaults are applied when keys are missing.

## 5. Integrate estuarine schema and metadata with `build_sliders` [pending]
### Dependencies: 1.2, 1.3, 1.4
### Description: Wire `EstuarineParams` and `PARAM_METADATA["estuarine"]` into `analog_image_generator.interactive.build_sliders` so UI sliders are generated from the shared configuration.
### Details:
Update `analog_image_generator.interactive.build_sliders` (or related interactive modules) to read from `PARAM_METADATA["estuarine"]` when requested mode is estuarine, generating slider controls whose ranges, defaults, and tooltips reflect the shared metadata and map cleanly onto `EstuarineParams`. Ensure any existing hardcoded estuarine sliders are removed or migrated, and that the function returns structures compatible with downstream consumers of estuarine parameters.
